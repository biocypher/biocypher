<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interacting with Neo4j &mdash; BioCypher  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/design-tabs.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Submodule documentation" href="submodule.html" />
    <link rel="prev" title="BioCypher Tutorial - Adapters" href="tutorial-adapter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="contents.html" class="icon icon-home">
            BioCypher
          </a>
              <div class="version">
                0.5.14
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-experiences.html">User Experiences</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-involved.html">Get Involved!</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="adapters.html">Adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">BioCypher Tutorial - Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial-ontology.html">BioCypher Tutorial - Handling Ontologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial-adapter.html">BioCypher Tutorial - Adapters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Interacting with Neo4j</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#communication-via-the-neo4j-python-driver">Communication via the Neo4j Python Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interacting-with-a-running-neo4j-instance">Interacting with a running Neo4j instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exporting-for-the-neo4j-admin-import-feature">Exporting for the <code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#translating-between-original-and-biocypher-vocabulary">Translating between original and BioCypher vocabulary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#tutorial-neo4j">Tutorial - Neo4j</a></li>
<li class="toctree-l1"><a class="reference internal" href="submodule.html">Submodule documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">BioCypher</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="contents.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Interacting with Neo4j</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/neo4j.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="interacting-with-neo4j">
<h1>Interacting with Neo4j<a class="headerlink" href="#interacting-with-neo4j" title="Permalink to this heading"></a></h1>
<p>BioCypher development was initially centred around a Neo4j graph database output
due to the migration of OmniPath to a Neo4j backend. Importantly, we understand
BioCypher as an abstration of the build process of a biomedical knowledge graph,
and thus are open towards any output format for the knowledge representation. We
are currently working on other output formats, such as RDF, SQL, and ArangoDB,
and will update the documentation accordingly. In the following section, we give
an overview of interacting with Neo4j from the perspective of BioCypher, but we
refer the reader to the Neo4j documentation for more details.</p>
<section id="communication-via-the-neo4j-python-driver">
<h2>Communication via the Neo4j Python Driver<a class="headerlink" href="#communication-via-the-neo4j-python-driver" title="Permalink to this heading"></a></h2>
<p>The BioCypher <span class="xref myst">Driver</span> is the main submodule of BioCypher. It
establishes a connection with a running graph database via the
<code class="xref py py-class docutils literal notranslate"><span class="pre">neo4j.GraphDatabase.driver</span></code>, integrates the funtions of the
other submodules, and serves as outside interface of BioCypher. The
<code class="docutils literal notranslate"><span class="pre">Driver</span></code> is the main class for interacting with BioCypher in the host
module’s adapter class. It handles authentification and basic database
management as well as the creation and manipulation of graph entries. It
can be instantiated and accessed like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">biocypher</span>

<span class="c1"># offline mode</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">biocypher</span><span class="o">.</span><span class="n">Driver</span><span class="p">(</span>
   <span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span><span class="p">,</span>
   <span class="n">offline</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># online mode</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">biocypher</span><span class="o">.</span><span class="n">Driver</span><span class="p">(</span>
   <span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span><span class="p">,</span>
   <span class="n">db_user</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span><span class="p">,</span>
   <span class="n">db_passwd</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In our example, it is instantiated in the initialisation of the adapter,
and then called on for <a class="reference internal" href="#running"><span class="std std-ref">interacting with a running graph</span></a> and
for exporting a complete database in CSV format for the <a class="reference internal" href="#admin-import"><span class="std std-ref">Neo4j
admin-import feature</span></a>. Upon instantiation, it
automatically assesses the graph database it is connected to (specified
using the <code class="docutils literal notranslate"><span class="pre">db_name</span></code> argument) regarding whether or not it already
contains a BioCypher graph, and, if so, what the structure of this graph
is.</p>
<p>If there exists no BioCypher graph in the currently active database, or
if the user explicitly specifies so using the <code class="docutils literal notranslate"><span class="pre">wipe</span></code> attribute of the
driver, a new BioCypher database is created using the schema
configuration specified in the <span class="xref myst">schema-config.yaml</span>.</p>
</section>
<section id="interacting-with-a-running-neo4j-instance">
<span id="running"></span><h2>Interacting with a running Neo4j instance<a class="headerlink" href="#interacting-with-a-running-neo4j-instance" title="Permalink to this heading"></a></h2>
<p>Once instantiated, the BioCypher driver can be used to modify the
current graph by adding or deleting nodes, edges, properties,
constraints, et cetera. Most commonly, the methods
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.add_nodes()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.add_edges()</span></code> are used to introduce new
entries into the graph database.</p>
</section>
<section id="exporting-for-the-neo4j-admin-import-feature">
<span id="admin-import"></span><h2>Exporting for the <code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> feature<a class="headerlink" href="#exporting-for-the-neo4j-admin-import-feature" title="Permalink to this heading"></a></h2>
<p>Particularly if the data are very extensive (or performance is of the
utmost priority), BioCypher can be used to facilitate a speedy and safe
import of the data using the <code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> console command.
<a class="reference external" href="https://neo4j.com/docs/operations-manual/current/tutorial/neo4j-admin-import/">Admin
Import</a>
is a particularly fast method of writing data to a newly created graph
database (the database needs to be completely empty) that gains most of
its performance advantage from turning off safety features regarding
input data consistency. Therefore, a sound and consistent representation
of the nodes and edges in the graph is of high importance in this
process, which is why the BioCypher export functionality has been
specifically designed to perform type and content checking for all data
to be written to the graph.</p>
<p>Data input from the source database is exactly as in the case of
<a class="reference internal" href="#running"><span class="std std-ref">interacting with a running database</span></a>, with the data
representation being converted to a series of CSV files in a designated
output folder (standard being <code class="docutils literal notranslate"><span class="pre">biocypher-out/</span></code> and the current datetime).
BioCypher creates separate header and data files for all node and edge
types to be represented in the graph via the driver methods
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.write_nodes()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.write_edges()</span></code>. Additionally, it creates
a file called <code class="docutils literal notranslate"><span class="pre">neo4j-admin-import-call.txt</span></code> containing the console
command for creating a new database, which only has to be executed from
the directory of the currently running Neo4j database.</p>
<p>The name of the database to be created is given by the <code class="docutils literal notranslate"><span class="pre">db_name</span></code>
attribute of the driver methods, ie, <code class="docutils literal notranslate"><span class="pre">write_nodes()</span></code> and
<code class="docutils literal notranslate"><span class="pre">write_edges()</span></code>, which should receive the same name as in the
<code class="docutils literal notranslate"><span class="pre">PyPath</span></code> adapter example, and can be arbitrary. In case the
<code class="docutils literal notranslate"><span class="pre">db_name</span></code> is not the default Neo4j database name, <code class="docutils literal notranslate"><span class="pre">neo4j</span></code>, the
database needs to be created in Neo4j before or after using the
<code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> statement. This can be done by executing, in the
running database (<code class="docutils literal notranslate"><span class="pre">&lt;db_name&gt;</span></code> being the name assigned in the method):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:use</span> <span class="pre">system</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">database</span> <span class="pre">&lt;db_name&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:use</span> <span class="pre">&lt;db_name&gt;</span></code></p></li>
</ol>
</section>
<section id="translating-between-original-and-biocypher-vocabulary">
<span id="translation"></span><h2>Translating between original and BioCypher vocabulary<a class="headerlink" href="#translating-between-original-and-biocypher-vocabulary" title="Permalink to this heading"></a></h2>
<p>For quickly transitioning to BioCypher, single terms or entire queries
can be translated using the information provided in the
<code class="docutils literal notranslate"><span class="pre">schema_config.yaml</span></code>. The translation functionality can be accessed
through the driver methods <code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.translate_term()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.reverse_translate_term()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.translate_query()</span></code>, and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.reverse_translate_query()</span></code>. For instance, to
find out the designation of “gene_gene” relationships in BioCypher, one
can call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">translate_term</span><span class="p">(</span><span class="s2">&quot;gene_gene&quot;</span><span class="p">)</span>
<span class="c1"># &#39;GeneToGeneAssociation&#39;</span>
</pre></div>
</div>
<p>Similarly, to discover the original naming of
“PostTranslationalInteraction” relationships, one can call the reverse
function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">reverse_translate_term</span><span class="p">(</span><span class="s2">&quot;PostTranslationalInteraction&quot;</span><span class="p">)</span>
<span class="c1"># &#39;post_translational&#39;</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.translate_query()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.reverse_translate_query()</span></code> replace all label
designations (following a “:”) in entire CYPHER query strings with the
BioCypher or original versions, respectively.</p>
</section>
</section>
<section id="tutorial-neo4j">
<span id="neo4j-tut"></span><h1>Tutorial - Neo4j<a class="headerlink" href="#tutorial-neo4j" title="Permalink to this heading"></a></h1>
<p>After writing knowledge graph files with BioCypher in offline mode for the Neo4j
DBMS, the graph can now be imported into Neo4j using the <code class="docutils literal notranslate"><span class="pre">neo4j-admin</span></code> command
line tool. This is not necessary if the graph is created in online mode. For
convenience, BioCypher provides the command line call required to import the
data into Neo4j:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bc</span><span class="o">.</span><span class="n">write_import_call</span><span class="p">()</span>
</pre></div>
</div>
<p>This creates an executable shell script in the output directory that can be
executed from the location of the database folder (or copied into the Neo4j
terminal) to import the graph into Neo4j. Since BioCypher creates separate
header and data files for each entity type, the import call conveniently
aggregates this information into one command, detailing the location of all
files on disk, so no data need to be copied around.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The generated import call is currently only compatible with Neo4j version 4.
Version 5 support coming soon!</p>
</div>
<p>Neo4j can manage multiple projects, each with multiple DBMS (database management
system) instances, each of which can house multiple databases. The screenshot
below shows a project managed by Neo4j Desktop (project name “BioCypher”)
containing a DBMS instance (called “Test DBMS”) with multiple named databases in
it: the non-removable “system” DB, the default “neo4j” DB, and several
user-created databases.</p>
<p><img alt="Neo4j Desktop" src="_images/DBMS.png" /></p>
<p>Crucially, the import call generated by BioCypher needs to be executed by the
<code class="docutils literal notranslate"><span class="pre">neo4j-admin</span></code> binary in the DBMS folder (in the <code class="docutils literal notranslate"><span class="pre">bin/</span></code> directory of the root of
the DBMS folder). The DBMS folder is the folder that contains the <code class="docutils literal notranslate"><span class="pre">data/</span></code>
directory, which in turn contains the <code class="docutils literal notranslate"><span class="pre">databases/</span></code> folder, which is where the
graph data is stored in individual folders corresponding to the DB names in the
DBMS. On Neo4j Desktop, you can open a terminal at the DBMS root location by
clicking on the three dots next to the DBMS name and selecting “Terminal” (see
screenshot below).</p>
<p><img alt="Neo4j Desktop" src="_images/DBMS-Terminal.png" /></p>
<p>Since the import call should be executed in the root of the DMBS folder,
BioCypher generates the import call starting with <code class="docutils literal notranslate"><span class="pre">bin/neo4j-admin</span></code>, which can
be copied into the terminal opened at the DBMS root location. For other
operating systems and Neo4j installations (e.g. in Docker containers), please
refer to the Neo4j documentation to find the correct location of your DMBS. We
are working on extensions of the BioCypher process to improve interoperability
with Neo4j as well as other storage systems.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Neo4j provide a <a class="reference external" href="https://neo4j.com/download-center/#desktop">Neo4j Desktop
application</a> that can be used to
create a local instance of Neo4j. The desktop application provides information
about the DBMS folder and can open a terminal at the DBMS root location. The
import call generated by BioCypher can then be copied into the terminal of the
Neo4j Desktop application for each corresponding DBMS.</p>
<p>Neo4j is also available as a command line interface (CLI) tool. To use the CLI
with the BioCypher admin import call, directory structures and permissions need
to be set up correctly. The Neo4j CLI tool can be downloaded from the <a class="reference external" href="https://neo4j.com/download-center/#community">Neo4j
download center</a>. Please follow
the <a class="reference external" href="https://neo4j.com/docs/">Neo4j documentation</a> for correct setup and usage
on your system.</p>
<p>Be mindful that different versions of Neo4j may differ in features and thus are
also documented differently.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial-adapter.html" class="btn btn-neutral float-left" title="BioCypher Tutorial - Adapters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="submodule.html" class="btn btn-neutral float-right" title="Submodule documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2023, BioCypher developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>